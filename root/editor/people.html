---
layout: editor
title: People Editor
lang: en
---

<div class="mb-3">
    <input type="text" class="form-control" id="searchBox" placeholder="Search by name or ID...">
</div>

<div class="list-container" id="peopleList"></div>

<div class="add-form">
    <h5>Add New Person</h5>
    <form id="addForm">
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label>IID (unique):</label>
                    <input type="number" class="form-control" id="newIid" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>ID (deprecated):</label>
                    <input type="text" class="form-control" id="newId" pattern="[a-z_]+">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Arabic Name:</label>
                    <input type="text" class="form-control" id="newArname" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>English Name:</label>
                    <input type="text" class="form-control" id="newEnname" required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <label>Level:</label>
                    <input type="number" class="form-control" id="newLevel" required>
                    <small class="form-text text-muted">-1/-2/-3 for special</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label>Graduation:</label>
                    <input type="number" class="form-control" id="newGraduation">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Codeforces:</label>
                    <input type="text" class="form-control" id="newCodeforces">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" class="form-control" id="newEmail">
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group form-check" style="margin-top: 32px;">
                    <input type="checkbox" class="form-check-input" id="newFemale">
                    <label class="form-check-label">Female</label>
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add Person</button>
    </form>
</div>

<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Person</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editIndex">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>IID:</label>
                            <input type="number" class="form-control" id="editIid">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>ID (deprecated):</label>
                            <input type="text" class="form-control" id="editId" pattern="[a-z_]+">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Arabic Name:</label>
                            <input type="text" class="form-control" id="editArname">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>English Name:</label>
                            <input type="text" class="form-control" id="editEnname">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Level:</label>
                            <input type="number" class="form-control" id="editLevel">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Graduation:</label>
                            <input type="number" class="form-control" id="editGraduation">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Codeforces:</label>
                            <input type="text" class="form-control" id="editCodeforces">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" class="form-control" id="editEmail">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-check" style="margin-top: 32px;">
                            <input type="checkbox" class="form-check-input" id="editFemale">
                            <label class="form-check-label">Female</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveEdit()">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
let people = [];
let filteredPeople = [];

async function loadData() {
    try {
        const resp = await fetch('/data/people.json');
        people = await resp.json();
        filteredPeople = [...people];
        renderPeople();
    } catch (error) {
        alert('Error loading data: ' + error.message);
    }
}

document.getElementById('searchBox').oninput = function(e) {
    const search = e.target.value.toLowerCase();
    if (search === '') {
        filteredPeople = [...people];
    } else {
        filteredPeople = people.filter(p => 
            p.enname.toLowerCase().includes(search) ||
            p.arname.includes(search) ||
            (p.id && p.id.includes(search)) ||
            p.iid.toString().includes(search)
        );
    }
    renderPeople();
};

function renderPeople() {
    const list = document.getElementById('peopleList');
    list.innerHTML = '';
    
    filteredPeople.forEach(p => {
        const actualIdx = people.indexOf(p);
        const card = document.createElement('div');
        card.className = 'item-card';
        card.innerHTML = `
            <div class="item-header">
                <div>
                    <strong>${p.enname}</strong> <small class="text-muted">(${p.arname})</small>
                    <br>
                    <small>IID: ${p.iid}${p.id ? ' | ID: ' + p.id : ''} | Level: ${p.level}${p.graduation ? ' | Grad: ' + p.graduation : ''}</small>
                </div>
                <div class="item-actions">
                    <button class="btn btn-sm btn-primary" onclick="editPerson(${actualIdx})">Edit</button>
                    <button class="btn btn-sm btn-danger" onclick="deletePerson(${actualIdx})">Delete</button>
                </div>
            </div>
        `;
        list.appendChild(card);
    });
}

function editPerson(idx) {
    const p = people[idx];
    document.getElementById('editIndex').value = idx;
    document.getElementById('editIid').value = p.iid;
    document.getElementById('editId').value = p.id || '';
    document.getElementById('editArname').value = p.arname;
    document.getElementById('editEnname').value = p.enname;
    document.getElementById('editLevel').value = p.level;
    document.getElementById('editGraduation').value = p.graduation || '';
    document.getElementById('editCodeforces').value = p.codeforces || '';
    document.getElementById('editEmail').value = p.email || '';
    document.getElementById('editFemale').checked = p.female || false;
    
    $('#editModal').modal('show');
}

function saveEdit() {
    const idx = parseInt(document.getElementById('editIndex').value);
    const p = people[idx];
    
    const newIid = parseInt(document.getElementById('editIid').value);
    const newId = document.getElementById('editId').value.trim();
    
    const iidDuplicate = people.some((person, i) => i !== idx && person.iid === newIid);
    const idDuplicate = newId && people.some((person, i) => i !== idx && person.id === newId);
    
    if (iidDuplicate) {
        alert('A person with this IID already exists');
        return;
    }
    
    if (idDuplicate) {
        alert('A person with this string ID already exists');
        return;
    }
    
    p.iid = newIid;
    p.id = newId || undefined;
    p.arname = document.getElementById('editArname').value;
    p.enname = document.getElementById('editEnname').value;
    p.level = parseInt(document.getElementById('editLevel').value);
    
    const grad = document.getElementById('editGraduation').value;
    p.graduation = grad ? parseInt(grad) : undefined;
    
    const cf = document.getElementById('editCodeforces').value.trim();
    p.codeforces = cf || undefined;
    
    const email = document.getElementById('editEmail').value.trim();
    p.email = email || undefined;
    
    const female = document.getElementById('editFemale').checked;
    p.female = female || undefined;
    
    $('#editModal').modal('hide');
    filteredPeople = [...people];
    renderPeople();
}

function deletePerson(idx) {
    const p = people[idx];
    if (confirm(`Delete ${p.enname}?`)) {
        people.splice(idx, 1);
        filteredPeople = [...people];
        renderPeople();
    }
}

document.getElementById('addForm').onsubmit = function(e) {
    e.preventDefault();
    
    const newIid = parseInt(document.getElementById('newIid').value);
    const newId = document.getElementById('newId').value.trim();
    
    if (people.some(p => p.iid === newIid)) {
        alert('A person with this IID already exists');
        return;
    }
    
    if (newId && people.some(p => p.id === newId)) {
        alert('A person with this string ID already exists');
        return;
    }
    
    const newPerson = {
        iid: newIid,
        arname: document.getElementById('newArname').value,
        enname: document.getElementById('newEnname').value,
        level: parseInt(document.getElementById('newLevel').value)
    };
    
    if (newId) newPerson.id = newId;
    
    const grad = document.getElementById('newGraduation').value;
    if (grad) newPerson.graduation = parseInt(grad);
    
    const cf = document.getElementById('newCodeforces').value.trim();
    if (cf) newPerson.codeforces = cf;
    
    const email = document.getElementById('newEmail').value.trim();
    if (email) newPerson.email = email;
    
    if (document.getElementById('newFemale').checked) {
        newPerson.female = true;
    }
    
    people.push(newPerson);
    this.reset();
    filteredPeople = [...people];
    renderPeople();
};

window.getData = () => people;

window.validateData = () => {
    const warnings = [];
    const iids = new Set();
    const ids = new Set();
    
    people.forEach(p => {
        if (iids.has(p.iid)) {
            warnings.push(`Duplicate IID: ${p.iid} (${p.enname})`);
        }
        iids.add(p.iid);
        
        if (p.id) {
            if (ids.has(p.id)) {
                warnings.push(`Duplicate ID: ${p.id} (${p.enname})`);
            }
            ids.add(p.id);
        }
    });
    
    return warnings;
};

loadData();
</script>