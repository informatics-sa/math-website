---
id: participations
layout: default
---

<style>
.page-header {
    background: linear-gradient(135deg, var(--bs-success) 0%, var(--bs-success-dark, #198754) 100%);
    border-radius: var(--bs-border-radius);
}

.year-cell {
    border-right: 3px solid var(--bs-success);
    font-weight: bold;
}

.year-2024, .year-2022, .year-2020, .year-2018, .year-2016, .year-2014, .year-2012, .year-2010 { 
    background-color: var(--bs-body-bg); 
}
.year-2023, .year-2021, .year-2019, .year-2017, .year-2015, .year-2013, .year-2011 { 
    background-color: var(--bs-secondary-bg, var(--bs-light)); 
}

.certificate-icon {
    width: 24px;
    height: 24px;
    display: inline-block;
}
</style>

<div class="container-fluid px-3 px-lg-4">
    
    <!-- <div class="page-header text-white p-4 p-lg-5 text-center mb-4 mt-4">
        <h1 class="display-4 fw-bold mb-2">🏆 
            <span>
                {% if page.lang == "ar" %}مشاركات المملكة العربية السعودية{% else %}Saudi Arabia Participations{% endif %}
            </span>
        </h1>
        <p class="lead opacity-75">
            <span>
                {% if page.lang == "ar" %}في أولمبياد الرياضيات الدولية والإقليمية{% else %}in International and Regional Mathematics Olympiads{% endif %}
            </span>
        </p>
    </div> -->

    <div class="row g-3 g-lg-4 mb-4 mt-1">
        <div class="col-12 col-md-6 col-lg-6">
            <div class="row mb-4 mt-1">
                <div class="col-2 col-sm-2 col-md-2 col-lg">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center h3">
                            <span class="fw-bold text-warning d-block" id="goldMedals">{{ page.stats.total_gold }}</span>
                            <i class="bi-award medal-gold"></i>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-md-2 col-lg">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center h3">
                            <span class="fw-bold text-secondary d-block" id="silverMedals">{{ page.stats.total_silver }}</span>
                            <i class="bi-award medal-silver"></i>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-md-2 col-lg">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center h3">
                            <span class="fw-bold text-danger d-block" id="bronzeMedals">{{ page.stats.total_bronze }}</span>
                            <i class="bi-award medal-bronze"></i>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-md-2 col-lg">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center h3">
                            <span class="fw-bold text-info d-block" id="honorableMentions">{{ page.stats.total_hm }}</span>
                            <svg class="certificate-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <!-- خلفية الشهادة -->
                              <rect x="3" y="4.5" width="18" height="12" rx="1" fill="#f8f9fa" stroke="#6c757d" stroke-width="0.5"/>
                              
                              <!-- خطوط النص -->
                              <line x1="5" y1="7" x2="17" y2="7" stroke="#495057" stroke-width="0.5"/>
                              <line x1="5" y1="9" x2="15" y2="9" stroke="#495057" stroke-width="0.5"/>
                              <line x1="5" y1="11" x2="16.5" y2="11" stroke="#495057" stroke-width="0.5"/>
                              <line x1="5" y1="13" x2="13.5" y2="13" stroke="#495057" stroke-width="0.5"/>
                              
                              <!-- ختم الشهادة -->
                              <circle cx="17" cy="14" r="1.8" fill="#dc3545" opacity="0.8"/>
                              <circle cx="17" cy="14" r="1.2" fill="none" stroke="#ffffff" stroke-width="0.3"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-md-2 col-lg">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center h3">
                            <span class="fw-bold text-success d-block" id="totalMedals">{{ page.stats.total_awards }}</span>
                            <i class="bi-patch-check-fill"></i>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    
        <div class="col-12 col-md-6 col-lg-6">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">
                            <span data-ar="تصفية حسب المسابقة:" data-en="Filter by Competition:">
                                {% if page.lang == "ar" %}تصفية حسب المسابقة:{% else %}Filter by Competition:{% endif %}
                            </span>
                        </label>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-dark btn-sm active filter-btn" data-filter="all">{% if page.lang == "ar" %}الكل{% else %}All{% endif %}</button>
                            {% for oo in (1..page.olympiads.count) %}
                            <button class="btn btn-outline-success btn-sm filter-btn" data-filter="{{ page.olympiads[oo] | upcase }}">{{ page.olympiads[oo] | upcase }}</button>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted" id="resultsCount">
                            <span data-ar="عرض جميع النتائج" data-en="Showing all results">
                                {% if page.lang == "ar" %}عرض جميع النتائج{% else %}Showing all results{% endif %} ({{ page.stats.total_participations }})
                            </span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="card shadow-sm mb-4">
        <div class="table-responsive">
            <table class="table mb-0" id="participationTable">
                <thead class="table-dark">
                    <tr>
                        {% if page.lang == "ar" %}
                        <th scope="col" class="text-center" width="8%">السنة</th>
                        <th scope="col">الأولمبياد</th>
                        <th scope="col">تاريخ المشاركة</th>
                        <th scope="col">المكان</th>
                        <th scope="col">الجوائز</th>
                        {% else %}
                        <th scope="col" class="text-center" width="8%">Year</th>
                        <th scope="col">Olympiad</th>
                        <th scope="col">Date</th>
                        <th scope="col">Country</th>
                        <th scope="col">Awards</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for year in (page.start_year..page.last_year) reversed %}
                        {% for idx in (1..page[year].count) %}
                            {% capture olyid %}{{page[year][idx].name}}_{{year}}{% endcapture %}
                            <tr class="participation-row" 
                                data-year="{{ year }}"
                                data-competition="{{ page[year][idx].name | upcase }}"
                                data-country="{% if page.lang == 'ar' %}{{ page[year][idx].country_arname }}{% else %}{{ page[year][idx].country_enname }}{% endif %}"
                                data-name="{% if page.lang == 'en' %}{{ page[year][idx].enname }}{% else %}{{ page[year][idx].arname }}{% endif %}">
                                
                                {% if idx == 1 %}
                                <td class="text-center year-cell year-{{ year }} align-middle fw-bold" rowspan="{{ page[year].count }}">{{ year }}</td>
                                {% else %}
                                <td class="d-none text-center year-cell year-{{ year }} align-middle fw-bold" rowspan="{{ page[year].count }}">{{ year }}</td>
                                {% endif %}
                                
                                <td>
                                    <a href="{% if page.lang == "en" %}/en{% endif %}/participations/{{olyid}}" class="text-decoration-none fw-semibold">
                                        
                                        {% if page.lang == "en" %}  
                                            {{ page[year][idx].enname }}
                                        {% else %}
                                            {{ page[year][idx].arname }}
                                        {% endif %}
                                        <span class="small text-muted">
                                            ({{ page[year][idx].name | upcase }})
                                        </span>
                                    </a>
                                    <!-- <div class="small text-muted"></div> -->
                                </td>
                                
                                <td>
                                    <input type="hidden" id="olstart-{{olyid}}" value="{{ page[year][idx].start }}">
                                    <input type="hidden" id="olend-{{olyid}}" value="{{ page[year][idx].end }}">
                                    {% if page[year][idx].start == page[year][idx].end %}
                                        {{ page[year][idx].start }}
                                    {% else %}
                                        {{ page[year][idx].start }} - {{ page[year][idx].end }}
                                    {% endif %}
                                </td>
                                
                                <td>
                                    {% if page.lang == 'ar' %}
                                        {{ page[year][idx].country_arname }}
                                    {% else %}
                                        {{ page[year][idx].country_enname }}
                                    {% endif %}
                                    
                                    {% if page[year][idx].online %}
                                    <span class="badge bg-secondary ms-2">
                                        {% if page.lang == 'ar' %}
                                        عن بعد 🌐
                                        {% else %}
                                        Online 🌐
                                        {% endif %}
                                    </span>
                                    {% endif %}
                                </td>
                                
                                <td class="awards-cell" id="olawards-{{olyid}}">
                                    {% assign medals = page[year][idx].awards | split: '' %}
                                    {% for medal in medals %}
                                        {% if medal == '🥇' or medal == '🥈' or medal == '🥉' or medal == '📜' %}
                                            <span class="fs-5 me-1">{{ medal }}</span>
                                        {% endif %}
                                    {% endfor %}
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
let allRows = [];
let filteredRows = [];
let activeFilters = new Set(['all']);

function init() {
    allRows = Array.from(document.querySelectorAll('.participation-row'));
    filteredRows = [...allRows];
    setupEventListeners();
    updateDateBadges();
}

function updateStats() {
    let gold = 0, silver = 0, bronze = 0, honorable = 0;
    filteredRows.forEach(row => {
        const medals = row.querySelector('.awards-cell').textContent;
        gold += (medals.match(/🥇/g) || []).length;
        silver += (medals.match(/🥈/g) || []).length;
        bronze += (medals.match(/🥉/g) || []).length;
        honorable += (medals.match(/📜/g) || []).length;
    });
    
    document.getElementById('totalCompetitions').textContent = filteredRows.length;
    document.getElementById('goldMedals').textContent = gold;
    document.getElementById('silverMedals').textContent = silver;
    document.getElementById('bronzeMedals').textContent = bronze;
    document.getElementById('honorableMentions').textContent = honorable;
    document.getElementById('totalMedals').textContent = gold + silver + bronze;
}

function updateResultsCount() {
    const count = filteredRows.length;
    const total = allRows.length;
    const isArabic = document.documentElement.lang === 'ar' || '{{ page.lang }}' === 'ar';
    
    document.getElementById('resultsCount').innerHTML = count === total ? 
        `<span data-ar="عرض جميع النتائج (${total})" data-en="Showing all results (${total})">${isArabic ? `عرض جميع النتائج (${total})` : `Showing all results (${total})`}</span>` :
        `<span data-ar="عرض ${count} من ${total} نتيجة" data-en="Showing ${count} of ${total} results">${isArabic ? `عرض ${count} من ${total} نتيجة` : `Showing ${count} of ${total} results`}</span>`;
}

function applyFilters() {
    filteredRows = allRows.filter(row => {
        return activeFilters.has('all') || activeFilters.has(row.dataset.competition);
    });

    // First, hide all rows
    allRows.forEach(row => {
        row.style.display = 'none';
    });

    // Hide all year cells initially
    document.querySelectorAll('.year-cell').forEach(cell => {
        cell.style.display = 'none';
        cell.removeAttribute('rowspan');
    });

    // Group filtered rows by year and show them with proper year cell handling
    const yearGroups = {};
    filteredRows.forEach(row => {
        const year = row.dataset.year;
        if (!yearGroups[year]) {
            yearGroups[year] = [];
        }
        yearGroups[year].push(row);
    });

    // Show filtered rows and set up year cells properly
    Object.keys(yearGroups).forEach(year => {
        const yearRows = yearGroups[year];
        yearRows.forEach((row, index) => {
            row.style.display = '';
            const yearCell = row.querySelector('.year-cell');
            
            if (index === 0) {
                // First row of the year - show the year cell with proper rowspan
                yearCell.style.display = '';
                yearCell.setAttribute('rowspan', yearRows.length);
                yearCell.classList.remove('d-none');
            } else {
                // Other rows - hide their year cells
                yearCell.style.display = 'none';
                yearCell.classList.add('d-none');
            }
        });
    });

    updateStats();
    updateResultsCount();

    // Not needed I guess
    const clearBtn = document.getElementById('clearFilters');
    if (activeFilters.has('all')) {
        clearBtn.classList.add('d-none');
    } else {
        clearBtn.classList.remove('d-none');
    }
}

function setupEventListeners() {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const filter = e.currentTarget.dataset.filter;
                
                if (filter === 'all') {
                    // إزالة جميع المرشحات الأخرى
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    activeFilters.clear();
                    activeFilters.add('all');
                }
                else {
                    // إزالة "الكل" إذا تم اختيار مرشح آخر
                    const allButton = document.querySelector('[data-filter="all"]');
                    allButton.classList.remove('active');
                    activeFilters.delete('all');
                    
                    // تبديل حالة المرشح الحالي
                    if (activeFilters.has(filter)) {
                        activeFilters.delete(filter);
                        e.currentTarget.classList.remove('active');
                    } else {
                        activeFilters.add(filter);
                        e.currentTarget.classList.add('active');
                    }
                    
                    // إذا لم يبق أي مرشح، اختر "الكل"
                    if (activeFilters.size === 0) {
                        allButton.classList.add('active');
                        activeFilters.add('all');
                    }
                }
                
                applyFilters();
            });
        });
    });
}

function updateDateBadges() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    function parseDate(dateStr) {
        const parts = dateStr.split('/');
        if (parts.length !== 3) return null;
        return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
    }
    
    function daysDiff(date1, date2) {
        return Math.ceil(Math.abs(date2 - date1) / (1000 * 60 * 60 * 24));
    }
    
    function arabicDays(days) {
        return days === 1 ? 'يوم' : days === 2 ? 'يومين' : days <= 10 ? `${days} أيام` : `${days} يوم`;
    }
    
    const isArabic = document.documentElement.lang === 'ar' || '{{ page.lang }}' === 'ar';
    
    document.querySelectorAll('[id^="olstart-"]').forEach(startEl => {
        const olyid = startEl.id.replace('olstart-', '');
        const endEl = document.getElementById('olend-' + olyid);
        const awardsEl = document.getElementById('olawards-' + olyid);
        
        if (!endEl || !awardsEl) return;
        
        const startDate = parseDate(startEl.value);
        const endDate = parseDate(endEl.value);
        
        if (!startDate || !endDate) return;
        
        let badgeHtml = '';
        if (today < startDate) {
            const days = daysDiff(today, startDate);
            const text = isArabic ? `سيبدأ بعد ${arabicDays(days)}` : `Starts in ${days} day${days === 1 ? '' : 's'}`;
            badgeHtml = `<span class="badge bg-info ms-2">${text}</span>`;
        } else if (today >= startDate && today <= endDate) {
            const days = daysDiff(today, endDate);
            const text = isArabic ? `سينتهي بعد ${arabicDays(days)}` : `Ends in ${days} day${days === 1 ? '' : 's'}`;
            badgeHtml = `<span class="badge bg-warning ms-2">${text}</span>`;
        }
        
        if (badgeHtml) {
            awardsEl.insertAdjacentHTML('beforeend', badgeHtml);
        }
    });
}

document.addEventListener('DOMContentLoaded', init);
</script>
